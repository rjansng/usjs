// ver 20230702
let ShopeeUserID = $persistentStore.read('ShopeeUserID') || '';
let _ShopeeUserID = ''; if (ShopeeUserID != '') _ShopeeUserID = `_${ShopeeUserID}`;
if (ShopeeUserID != '') { console.log(ShopeeUserID); }
let UseUserId = $persistentStore.read('UseUserId') || '';
if (UseUserId != '1') { ShopeeUserID = ''; _ShopeeUserID = ''; console.log('‰ΩøÁî®Êú¨Ê©üË≥áÊñô„ÄÇ'); }

const caption = 'üéÆÈÅäÊà≤Áé©ÈÅé';
const title = 'Ëù¶ÁöÆÊãºÊãºÊ®Ç Ëá™Âãï' + caption;
const version = 'v20241021'; // 20241001 start
let showNotification = true;
let needLastNotify = true;
let showLog = true;
let config = null;
let dataList = [];
const NotShowNotification = $persistentStore.read('NotShowNotification'); if (NotShowNotification) { showNotification = false; }
const NotShowLog = $persistentStore.read('ShowLog'); if (NotShowLog) { showLog = false; }
function getRnd(len = 16) { return (Math.random() * 10 ** 20).toFixed(0).substring(0, len); }
function getToken() { return (new Date()).getTime().toString(); }
function loonNotifyArray(m) { if (Array.isArray(m)) { loonNotify(m[0], m[1]); } else { loonNotify(m); } };
function loonNotify(subtitle = '', message = '', url = 'shopeetw://') { if (showNotification) { $notification.post(title, subtitle, message, { 'openUrl': url }); } if (showLog) { console.log(`${title}\t${subtitle}\t${message}`); } };
function handleError(error) {
	let sl = showLog; showLog = false; let msg = '‚ùå';
	if (Array.isArray(error)) {
		for (let i = 0; i < error.length; i++) {
			const e = error[i]; msg += (i > 1 ? '\n' : ' ') + `${e}`;
		}
	}
	else { msg += ` ${error}`; }
	console.log(msg); loonNotifyArray(error); showLog = sl;
}
function getSaveObject(key) { const string = $persistentStore.read(key); return !string || string.length === 0 ? {} : JSON.parse(string); }
function isEmptyObject(obj) { return Object.keys(obj).length === 0 && obj.constructor === Object ? true : false; }
function cookieToString(cookieObject) { let string = ''; for (const [key, value] of Object.entries(cookieObject)) { string += `${key}=${value};` } return string; }
async function delay(seconds) { console.log(`\t\t\t\t\t\t\t‚è∞ Á≠âÂæÖ ${seconds} Áßí`); return new Promise((resolve) => { setTimeout(() => { resolve(); }, seconds * 1000); }); }
function GetDataConfig(item = -1, method = 'POST', url = '', title = '', content = '', func = null) {
	if (item === -1) {
		return {
			'item': item, 'method': method, 'url': url, 'title': title, 'content': content, 'memo': ''
			, 'dataRequest': { url: '', headers: config.shopeeHeaders, body: null }, 'func': ud[6],
		};
	}
	let ud = UrlData[item];
	let dc = {
		'item': item, 'method': ud[0], 'title': ud[1], 'content': ud[2], 'url': ud[3], 'memo': '',
		'dataRequest': { url: '', headers: null, body: null }, 'func': ud[6],
	};
	let params = null;
	params = ud[5];
	if (dc.method === 'POST') { dc.dataRequest.body = DataPostBodyList[dc.item]; }
	dc.dataRequest.headers = config.shopeeHeaders;
	if (params && params.length > 0) {
		for (let i = 0; i < params.length; i++) {
			const p = params[i];
			dc.url = dc.url.replace(`\{${p}\}`, config[p]);
		}
	}
	dc.dataRequest.url = dc.url;
	if (func != null && typeof (func) === 'function') { dc = func(dc); }
	return dc;
}
Date.prototype.format = function (format) {
	if (!(format)) format = 'yyyy/MM/dd';
	var o = {
		"M+": this.getMonth() + 1, //month  
		"d+": this.getDate(),    //day  
		"h+": this.getHours(),   //hour  
		"H+": this.getHours(),   //hour  
		"m+": this.getMinutes(), //minute  
		"s+": this.getSeconds(), //second  
		"q+": parseInt((this.getMonth() + 3) / 3),  //quarter  
		"S": this.getMilliseconds() //millisecond  
	}
	if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
		(this.getFullYear() + "").substr(4 - RegExp.$1.length));
	for (var k in o) if (new RegExp("(" + k + ")").test(format))
		format = format.replace(RegExp.$1,
			RegExp.$1.length === 1 ? o[k] :
				("00" + o[k]).substr(("" + o[k]).length));
	return format;
};

async function dataGet(dc, item = -1) {
	return new Promise((resolve, reject) => {
		try {
			let msg = `üåê ${dc.title} ...`;
			if (item >= 0) { msg += ` (${item})`; }
			console.log(msg);
			$httpClient.get(dc.dataRequest, function (error, response, data) {
				if (error) {
					return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, 'ÈÄ£Á∑öÈåØË™§']);
				} else {
					if (response.status === 200) {
						return resolve(data);
					} else {
						return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, response.status, data]);
					}
				}
			});
		} catch (error) {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, error]);
		}
	});
}
async function dataPost(dc, item = -1) {
	return new Promise((resolve, reject) => {
		try {
			let msg = `üåê ${dc.title} ...`;
			if (item >= 0) { msg += ` (${item})`; }
			console.log(msg);
			$httpClient.post(dc.dataRequest, function (error, response, data) {
				if (error) {
					return reject([`${content}Â§±Êïó ‚ÄºÔ∏è`, 'ÈÄ£Á∑öÈåØË™§']);
				} else {
					if (response.status === 200) {
						return resolve(data);
					} else {
						return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, response.status, data]);
					}
				}
			});

		} catch (error) {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, error]);
		}
	});
}
async function preCheck() {
	return new Promise((resolve, reject) => {
		const shopeeInfo = getSaveObject('ShopeeInfo' + _ShopeeUserID);
		if (isEmptyObject(shopeeInfo)) {
			return reject(['Ê™¢Êü•Â§±Êïó ‚ÄºÔ∏è', 'Ê≤íÊúâ Ëù¶ÁöÆ Token']);
		}
		const shopeeHeaders = {
			'Cookie': `${cookieToString(shopeeInfo.token)}`,
			'Content-Type': 'application/json',
		}
		config = {
			shopeeInfo: shopeeInfo,
			shopeeHeaders: shopeeHeaders,
		}
		console.log('‚úÖ Ê™¢Êü•ÊàêÂäü');
		return resolve();
	});
}
let task = {
	'taskFinishNum': 2,
	'isNewUserTask': false,
	'taskId': 0,
	'forceClaim': false,
};
let taskStatus = {};
async function ProcData1X1(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		if (obj.code === 0) {
			// console.log(obj.data);

			if (!found && obj.data.games) {
				for (let i = 0; i < obj.data.games.length; i++) {
					const g = obj.data.games[i];
					if (g.app_id === config.appid) {
						found = true;
						config.activityId = g.link_url.replace(/^.+\/tilematch\/\?activity=([0-9a-f]{14,16})(&.+)?/i, '$1');
						console.log(`AID : ${config.activityId}`);
						break;
					}
				}
			}
			if (!found && obj.data.no_chance_games) {
				for (let i = 0; i < obj.data.no_chance_games.length; i++) {
					const g = obj.data.no_chance_games[i];
					if (g.app_id === config.appid) {
						found = true;
						config.activityId = g.link_url.replace(/^.+\/tilematch\/\?activity=([0-9a-f]{14,16})(&.+)?$/i, '$1');
						console.log(`AID : ${config.activityId}`);
						break;
					}
				}
			}
			if (!found) {
				console.log('ÁõÆÂâçÊ≤íÊúâÊãºÊãºÊ®ÇÈÅäÊà≤');
				console.log(obj.data);
			}
			else {
				taskStatus.item = 3;
				taskStatus.canReward = false;
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}
async function ProcData1(data, dc) {
	return new Promise((resolve, reject) => {

		let found = false;
		let obj = JSON.parse(data);

		let tasks = obj.data.userTasks;
		for (let i = 0; i < tasks.length; i++) {
			if (tasks[i].length == 1) {
				//console.log(tasks[i])
				let ti = tasks[i][0].taskInfo;
				if (tasks[i][0].taskFinishStatus != 3) {
					//console.log(ti.Id + '\t' + ti.taskName);
					if (ti.taskName.includes('ÊãºÊãºÊ®Ç') && !ti.taskName.includes('Ëù¶Âπ£')) {
						console.log(`ÊâæÂà∞‰ªªÂãô ${ti.taskName} (${ti.Id})`);
						found = true;
						if (ti.taskName.includes('ÊãºÊãºÊ®Ç')) { taskStatus.item = 3; }
						taskStatus.name = ti.taskName;
						taskStatus.canReward = tasks[i][0].canReward;
						task.isNewUserTask = ti.isNewUserTask;
						task.taskId = ti.Id;
						task.taskFinishNum = tasks[i][0].taskFinishNum;
						let activityId = ti.ctaUrl.replace(/^.+\/tilematch\/\?activity=([0-9a-f]{16})(&.+)?/i, '$1');
						console.log('AID : ' + activityId);
						if (!activityId.match(/\/\//)) { config.activityId = activityId; }
						config.canReward = taskStatus.canReward;
						config.hasTileMatch = true;
						config.canTask = !taskStatus.canReward;
						break;
					}
				}
			}
		}
		if (found) {
			if (taskStatus.item === 2 && !taskStatus.canReward) {
				found = false;
				console.log(`Ë´ãÊâãÂãïÁé©ÈÅé ${taskStatus.name}`);
			}
			else if (taskStatus.item === 3 && !taskStatus.canReward) {
			}
			if (found) {
				console.log(`${taskStatus.name} ${(taskStatus.canReward ? 'È†òÂèñÊ∞¥Êª¥üíß' : 'Âü∑Ë°åÁé©ÈÅé')}`);
			}
		}
		else {
			console.log(`Â∑≤ÂÆåÊàêÊâÄÊúâ ${caption} ‰ªªÂãô`);
		}
		return resolve(found);
	});
}
async function ProcData1X2(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		// console.log(obj);
		if (obj.code === 0) {
			let ut = obj.data.user_tasks;
			if (ut && ut.length > 0) {
				ut.forEach(t => {
					if (t.task.task_name.includes('ÊãºÊãºÊ®Ç')) { // ÊãºÊãºÊ®Ç Êú™ÂÆåÊàê
						if (t.task_status != 3 && !t.can_reward) {
							console.log(t.task.task_name);
							config.hasTask = true;
							// config.canTask = true;
							found = true;
						}
						return true;
					}
				});
			}
			else {
				console.log('ÁèæÂú®Ê≤íÊúâ‰ªªÂãô„ÄÇ');
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}

async function ProcData2(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		if (obj.code === 0) {

			if (obj.data.claimValue > 0) {
				found = true;
				console.log(`ÊàêÂäüÈ†òÂèñ ${obj.data.claimValue} Ê∞¥Êª¥üíß`);

				try {
					let dataName = 'ShopeeGamePlayed' + _ShopeeUserID;
					let tsn = 'farm' + 's';
					let tsid = 'TG6';
					let tsidT = 'TS';
					let rs = $persistentStore.read(dataName) || '{"gameTime":0}';
					let tasks = JSON.parse(rs);
					let ts = {}, s = {}, sT = {};
					if (tasks.hasOwnProperty(tsn)) { ts = tasks[tsn]; }
					if (ts.hasOwnProperty(tsid)) { s = ts[tsid]; } else { s = { 'c': 0, 'l': 0, 's': 0, 'f': false, 'd': [], 'r': '' }; }
					if (ts.hasOwnProperty(tsidT)) { sT = ts[tsidT]; } else { sT = { 'c': 0, 'l': 0, 's': 0, 'f': false, 'd': [], 'r': '' }; }
					s.c++;
					s.f = s.c > 0;//&& s.s === 0;
					sT.c++;
					sT.r += `\nüîÜ${taskStatus.name}`;
					ts[tsid] = s;
					ts[tsidT] = sT;
					if (found) {
						tasks[tsn] = ts;
						$persistentStore.write(JSON.stringify(tasks), dataName);
					}
				} catch (e) { console.log(e); }

			}
			else {
				console.log(`È†òÂèñ ${obj.data.claimValue} Ê∞¥Êª¥üíß`);
				console.log(data);
				console.log(obj);
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}
async function ProcData3(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		if (obj.code === 0) {

			let found1 = false;
			let found2 = false;
			let basic = obj.data.curr_basic;
			let modules = obj.data.modules;
			let ndt = new Date().getTime();
			console.log(obj.data.activity.activity_name);
			// console.log(new Date(ndt).format('yyyy/MM/dd HH:mm:ss'));
			// console.log('');
			// console.log(new Date(basic.start_time * 1000).format('yyyy/MM/dd HH:mm:ss'));
			// console.log(new Date(basic.end_time * 1000).format('yyyy/MM/dd HH:mm:ss'));
			// console.log(basic);
			if (ndt < (basic.end_time * 1000)) {
				// console.log(obj.data.activity.activity_name);
				//config.event_code = basic.event_code;
				for (let i = 0; i < basic.slots.length; i++) {
					let slot = basic.slots[i];
					// console.log('');
					// console.log(slot.slot_name);
					// console.log(new Date(slot.start_time * 1000).format('yyyy/MM/dd HH:mm:ss'));
					// console.log(new Date(slot.end_time * 1000).format('yyyy/MM/dd HH:mm:ss'));
					if (slot.page_key === 'page_run_time'
						&& (slot.start_time * 1000) < ndt && (slot.end_time * 1000) > ndt) {
						found1 = true;
						console.log(slot.slot_name);
						config.slot_code = slot.slot_code;
						console.log(`SID : ${config.slot_code}`)
						break;
					}
				}
				for (let i = 0; i < modules.length; i++) {
					let module = modules[i];
					if (module.module_name === 'Service.NEW_RANK' && module.module_key === 'rank_global') {
						found2 = true;
						config.module_id = module.module_id;
						console.log(`MID : ${config.module_id}`)
						break;
					}
				}
				// console.log(`${found1},${found2}`);
				found = found1 && found2;
				if (!found) {
					console.log('Êâæ‰∏çÂà∞ Service.NEW_RANK');
					console.log(basic);
					console.log(modules);
				}

			}
			else {
				console.log('\nÊ¥ªÂãïÂ∑≤ÁµêÊùü„ÄÇ');
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}

async function ProcData4(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		if (obj.code === 0) {
			found = true;

			// console.log(obj.data);
			if ('map' in obj.data) {
				console.log(obj.data.map);
				console.log(obj.data.levelMode);
				config.map = obj.data.map;
				config.levelMode = obj.data.levelMode;
				// DataPostBodyList[7].map = obj.data.map;
				// DataPostBodyList[7].requestID = config.shopeeInfo.token.SPC_U + '_' + getToken();
				// DataPostBodyList[7].levelMode = obj.data.levelMode;
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}
async function ProcData5(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		// console.log(data);
		let obj = JSON.parse(data);
		if (obj.code === 0) {

			found = true;
			// console.log(obj.data);
			try {
				if ('token' in obj.data) {
					config.token = obj.data.token;
					console.log(obj.data.token);
					// DataPostBodyList[8].token = obj.data.token;
					// DataPostBodyList[8].requestID = config.shopeeInfo.token.SPC_U + '_' + getToken();
				}
			} catch (e) {
				console.log(e);
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}
async function ProcData6(data, dc) {
	return new Promise((resolve, reject) => {
		let found = true;
		// console.log(data);
		var aaa = new RegExp(/[¬§√Ä√Å√Ç√É√Ñ√Ö√Ü√á√à√â√ä√ã√å√ç√é√è√ê√ë√í√ì√î√ï√ñ√ò√ô√ö√õ√ú√ù√û≈†≈∏≈í¬∫¬¢]/g);
		var bbb = new RegExp(/{¬¥\d¬¥|¬¶/g);
		let o = data.split('{¬¥1¬¥|¬¶');
		if (o.length >= 4) {
			var aa1 = o[1].split('}')[0];
			var aa2 = o[2].split('}')[0];

			console.log(aa1);
			console.log(aa1.match(aaa).length / 2);
			console.log(aa1.match(bbb).length + 2);
			console.log('');
			console.log(aa2);
			console.log(aa2.match(aaa).length / 2);
			console.log(aa2.match(bbb).length + 2);

			config.ga1 = aa1.match(aaa).length / 2;
			config.ga2 = aa1.match(bbb).length + 2;
			config.gb1 = aa2.match(aaa).length / 2;
			config.gb2 = aa2.match(bbb).length + 2;
		}
		return resolve(found);
	});
}
async function ProcData7(data, dc) {
	return new Promise((resolve, reject) => {
		let found = false;
		let obj = JSON.parse(data);
		if (obj.code === 0) {
			found = true;
			if(obj.data.reward)
			{
				console.log(obj.data.reward);
			}
			else
			{
				console.log('ÁçéÂà©Â∑≤È†ò');
			}
		}
		else {
			return reject([`Âü∑Ë°åÂ§±Êïó ‚ÄºÔ∏è`, obj.msg, data]);
		}
		return resolve(found);
	});
}
let UrlData = [[],
['GET', '01 ÂèñÂæóÈÅäÊà≤Ê∏ÖÂñÆC2', '1', 'https://games.shopee.tw/gameplatform/api/v2/game_reco/games/channels/2', '', , ProcData1X1],
['GET', '01 ÂèñÂæóüí∞ÊàëÁöÑËù¶Âπ£ ‰ªªÂãôÊ∏ÖÂñÆ', '2', 'https://games-dailycheckin.shopee.tw/mkt/coins/api/v2/tasks', '', , ProcData1X2],
['GET', '01 ÂèñÂæó‚ÑπÔ∏è‰ªªÂãôË≥áË®ä', '3', 'https://games.shopee.tw/farm/api/task/listV2?groceryEntryOn=true&withMicrosite=1', '', , ProcData1],
['POST', '02 È†òÂèñÊ∞¥Êª¥üíß', '4', 'https://games.shopee.tw/farm/api/task/reward/claim', '', , ProcData2],
['GET', '03 ÂèñÂæóÊãºÊãºÊ®ÇË≥áË®ä', '5', 'https://games.shopee.tw/gameplatform/api/v5/game/activity/{activityId}/settings?appid={appid}', '', ['appid', 'activityId'], ProcData3],
['GET', '04 ÂèñÂæóÊãºÊãºÊ®Ç‰∏ªÈ†Å', '6', 'https://games.shopee.tw/api-gateway/tilematch_api/game/home?activityCode={activityId}&slotCode={slot_code}', '', ['activityId', 'slot_code'], ProcData4],
['POST', '05 ÈñãÂßãÁé©ÊãºÊãºÊ®Ç', '7', 'https://games.shopee.tw/api-gateway/tilematch_api/game/play?activityCode={activityId}&slotCode={slot_code}', '', ['activityId', 'slot_code'], ProcData5],
// ['GET', '07 ÂèñÂ∑±LEVELË≥áË®ä', '8', '{map}', '', ['map'], ProcData6],
// ['POST', '08 Áé©ÊãºÊãºÊ®ÇÁ∫åÈóú2', '9', 'https://games.shopee.tw/api-gateway/tilematch_api/game/winplay?activityCode={activityId}&slotCode={slot_code}', '', ['activityId', 'slot_code'], ProcData7],
// ['POST', '09 Áé©ÊãºÊãºÊ®ÇÁ∫åÈóú3', '10', 'https://games.shopee.tw/api-gateway/tilematch_api/game/winplay?activityCode={activityId}&slotCode={slot_code}', '', ['activityId', 'slot_code'], ProcData7],
];

let DataPostBodyList = [, , , , {}, , ,
	{
		"map": "https://games.deo.shopeemobile.com/shopee/mkt/games/file/6aaf242520d397f902c4bf542ed65d84/level21_level.json",
		"requestID": "681985929_1729121816743",
		"levelMode": 0
	}, ,
	{
		"token": "01JABV24KNJS9S9DCTVPJTKRBW",
		"info": {
			"propUse": {
				"undo": 0,
				"shuffle": 0,
				"magnet": 0,
				"revive": 0,
				"extraSlot": 0,
				"remove": 0
			},
			"targetTiles": 18,
			"level": 1,
			"clearTiles": 18,
			"tilesType": 3,
			"moveTiles": 18
		},
		"requestID": "681985929_1729121827228"
	},
	{
		"token": "01JABV24KNJS9S9DCTVPJTKRBW",
		"info": {
			"propUse": {
				"undo": 0,
				"shuffle": 0,
				"magnet": 0,
				"revive": 0,
				"extraSlot": 0,
				"remove": 0
			},
			"targetTiles": 18,
			"level": 2,
			"clearTiles": 18,
			"tilesType": 3,
			"moveTiles": 18
		},
		"requestID": "681985929_1729121827228"
	}

];
// {
// 	"user_avatar": "",
// 	"prop_img": "tw-11134001-22120-vsqgouvsxdlv7f",
// 	"chance_module_id": 42489,
// 	"transaction_id": "16764244768280.5079947208830323",
// 	"box_type": 1,
// 	"next_refresh_time": 1676476800000,
// 	"item_id": "AAAAAAAAAAAAAAAAAAAAAFj3Msggu/WfWTK7NnbYBBfvsaO8oheewHgBQJIWqZZPxoXUaV0dzuupIDE15aYeIw==",
// 	"exp_group_id": 24003
// }

function preInit() {
	config.appid = 'kRFxgyO375Zyt3wjez';
	config.activityId = ''; // f18c7c0e1da7e401
	config.slot_code = '7eab27d10356b0b2';
	config.event_id = '7eab27d10356b0b2';
	config.module_id = 42489;
	config.group_id = 24003;
	config.transaction_id = getToken() + "." + getRnd();
	config.canReward = false;
	config.hasTileMatch = false;
	config.hasTask = false;
	config.token = '';
	// config.ldc_id = 190309;
	// let DTn = new Date();
	// let DTL = new Date(DTn.getFullYear(), DTn.getMonth(), DTn.getDate() + 1).getTime();
	// config.next_refresh_time = 0;
	// config.item_id = "AAAAAAAAAAAAAAAAAAAAAFj3Msggu/WfWTK7NnbYBBfvsaO8oheewHgBQJIWqZZPxoXUaV0dzuupIDE15aYeIw==";
}
// [¬§√Ä√Å√Ç√É√Ñ√Ö√Ü√á√à√â√ä√ã√å√ç√é√è√ê√ë√í√ì√î√ï√ñ√ò√ô√ö√õ√ú√ù√û≈†≈∏≈í¬∫¬¢]
const forMaxCount = 15;
(async () => {
	console.log(`‚ÑπÔ∏è ${title} ${version}`);
	try {
		await preCheck();
		preInit();
		needLastNotify = false;
		let flag = true;
		let runCount = 0;
		let item = -1;
		// config.hasTask = true;
		// var ddd = '|{¬®width¬®√ë¬®height¬®√ë¬®levelId¬®¬§Q¬®levelKey¬®√ä¬®blockTypeData¬®{¬¥1¬¥√ã¬¥2¬¥√ã¬®15¬®√ã}¬®levelData¬®{¬¥1¬¥|¬¶¬®colNum¬®¬®rowNum¬®‚Ä°¬§G¬§G¬§S¬§G¬§e¬§G¬§G¬§W¬§S¬§W¬§e¬§W¬§G¬§m¬§S¬§m¬§e¬§m‚Äî√∑¬¥2¬¥|¬¶√ü7√ü8‚Ä°¬§G¬§K¬§S¬§K¬§e¬§K¬§G¬§a¬§S¬§a¬§e¬§a¬§G¬§q¬§S¬§q¬§e¬§q‚Äî√∑}}{√ü0√ë√ü1√ë√ü2¬§Q√ü3√ã√ü4{¬¥0¬¥√å¬¥1¬¥√å¬¥2¬¥√ã¬¥3¬¥√ã¬¥4¬¥√ã¬¥5¬¥√ã}√ü6{¬¥1¬¥|¬¶√ü7√ü8‚Ä°√ë√ë¬§G√ë√ë¬§G¬§G¬§G¬§e√ë¬§m√ë¬§e¬§G¬§m¬§G√ë¬§m¬§G¬§m√ë¬§u¬§G¬§u¬§e¬§m¬§m¬§m¬§e¬§u¬§m¬§u‚Äî√∑¬¥2¬¥|¬¶√ü7√ü8‚Ä°¬§C¬§K¬§K¬§C¬§K¬§K¬§a¬§C¬§a¬§K¬§i¬§K¬§K¬§i¬§C¬§i¬§K¬§q¬§a¬§i¬§i¬§i¬§a¬§q‚Äî√∑¬¥3¬¥|¬¶√ü7√ü8‚Ä°¬§O¬§e¬§O¬§W¬§O¬§O¬§W¬§O¬§W¬§W¬§W¬§e‚Äî√∑¬¥4¬¥|¬¶√ü7√ü8‚Ä°¬§K¬§S¬§K¬§a¬§a¬§S¬§a¬§a‚Äî√∑¬¥5¬¥|¬¶√ü7√ü8‚Ä°¬§G¬§W¬§O¬§W¬§W¬§W¬§e¬§W‚Äî√∑}}{√ü0√ë√ü1¬§A√ü2¬§Q√ü3√å√ü4{¬¥0¬¥√é¬¥1¬¥√é¬¥2¬¥√é¬¥3¬¥√é¬¥4¬¥√é¬¥5¬¥√è¬¥6¬¥√é¬¥7¬¥√é¬¥8¬¥√é¬¥9¬¥√é¬®11¬®√é¬®12¬®√é¬®13¬®√é¬®14¬®√é√ü5√é}√ü6{¬¥1¬¥|¬¶√ü7¬®DDType¬®√ü8‚Ä°¬§O√ä¬§G¬§W√ä¬§G¬§S√ä¬§O¬§S√ä¬§W¬§C√ä¬§W√ç√ä¬§e¬§i√ä¬§W¬§q√ä¬§e‚Äî{√ü8¬§y√ü7√ë}{√ü8¬¢16√ü7√ë}{√ü8¬§y√ü7¬§G}{√ü8¬∫0√ü7¬§G}{√ü8¬§y√ü7¬§m}{√ü8¬∫0√ü7¬§m}{√ü8¬§y√ü7¬§e}{√ü8¬∫0√ü7¬§e}√∑¬¥2¬¥|¬¶√ü7√üD√ü8‚Ä°¬§S√ä¬§K¬§S√ä¬§S√ë√ä¬§a¬§m√ä¬§a‚Äî{√ü8¬§y√ü7√ç}{√ü8¬§y√ü7¬§C}{√ü8¬¢12√ü7¬§K}{√ü8¬∫0√ü7√ç}{√ü8¬∫0√ü7¬§C}{√ü8¬§y√ü7¬§q}{√ü8¬§y√ü7¬§i}{√ü8¬∫1√ü7¬§a}{√ü8¬∫0√ü7¬§q}{√ü8¬∫0√ü7¬§i}{√ü8√ë√ü7√è¬®moldType¬®√ã}{√ü8√ë√ü7¬§o√üE√ã}√∑¬¥3¬¥|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e√ë¬∫1¬§G¬∫0¬§G¬§y¬§m¬∫1¬§e¬∫0¬§e¬§y‚Äî{√ü8√ë√ü7√ê√üE√ã}{√ü8√ë√ü7¬§n√üE√ã}√∑¬¥4¬¥|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî{√ü8√ë√ü7√ë√üE√ã}{√ü8√ë√ü7¬§m√üE√ã}√∑¬¥5¬¥|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî{√ü8√ë√ü7√í√üE√ã}{√ü8√ë√ü7¬§l√üE√ã}√∑¬¥6¬¥|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî{√ü8√ë√ü7¬§A√üE√ã}{√ü8√ë√ü7¬§k√üE√ã}√∑¬¥7¬¥|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî{√ü8√ë√ü7¬§B√üE√ã}{√ü8√ë√ü7¬§j√üE√ã}√∑¬¥8¬¥|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî{√ü8√ë√ü7¬§C√üE√ã}{√ü8√ë√ü7¬§i√üE√ã}√∑¬¥9¬¥|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî{√ü8√ë√ü7¬§D√üE√ã}{√ü8√ë√ü7¬§h√üE√ã}√∑¬®10¬®|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî{√ü8√ë√ü7¬§E√üE√ã}{√ü8√ë√ü7¬§g√üE√ã}√∑√ü9|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî{√ü8√ë√ü7¬§F√üE√ã}{√ü8√ë√ü7¬§f√üE√ã}√∑√üA|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî√∑√üB|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî√∑√üC|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî√∑√ü5|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî√∑¬®16¬®|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî√∑¬®17¬®|¬¶√ü7√ü8‚Ä°¬§O¬§G¬§W¬§G¬§S¬§O¬§S¬§W¬§C¬§W√ç¬§e¬§i¬§W¬§q¬§e‚Äî√∑¬®18¬®|¬¶√ü7√ü8‚Ä°¬§S¬§K¬§S¬§S√ë¬§a¬§m¬§a‚Äî√∑¬®19¬®|¬¶√ü7√ü8‚Ä°¬§S¬§O¬§O¬§G¬§C¬§W√ç¬§W√ç¬§e¬§C¬§e¬§S¬§a¬§W¬§G¬§i¬§W¬§q¬§W¬§q¬§e¬§i¬§e‚Äî√∑¬®20¬®|¬¶√ü7√ü8‚Ä°¬§S¬§e¬§S¬§W√ç¬§a√ç¬§i¬§O¬§O¬§C¬§a¬§C¬§i¬§S¬§C√ç¬§S¬§q¬§a¬§q¬§i¬§W¬§O¬§i¬§a¬§i¬§i¬§q¬§S‚Äî√∑¬®21¬®|¬¶√ü7√ü8‚Ä°¬§K¬§S¬§S¬§K¬§O¬§a¬§S¬§i√ë¬§W√ë¬§O¬§G¬§m√ë¬§e√ë¬§m¬§O¬§C¬§S¬§S¬§a¬§S¬§W¬§a¬§m¬§W¬§m¬§O¬§e¬§m¬§m¬§e¬§m¬§m¬§W¬§C‚Äî√∑¬®22¬®|¬¶√ü7√ü8‚Ä°¬§C¬§i√ç¬§q¬§C¬§q√ç¬§i√ç¬§S¬§C¬§K¬§C¬§S√ç¬§K¬§S¬§G¬§S¬§O¬§S¬§W¬§O¬§e¬§S¬§m¬§K¬§W¬§K¬§q¬§O√ë¬§C¬§a¬§i¬§i¬§q¬§q¬§i¬§q¬§q¬§i¬§q¬§S¬§i¬§K¬§i¬§S¬§q¬§K¬§W¬§e¬§a¬§W¬§a¬§q¬§W√ë¬§i¬§a‚Äî√∑}¬®isGen¬®√ä¬®levelType¬®¬®normal¬®}√∑';
		// await ProcData6(ddd);
		// flag = false;
		for (let i = 1; i < UrlData.length; i++) {
			if (!flag) { break; }
			if (i == 3) {
				console.log('');
				// if (runCount > 2) { await delay(3.0); }
			}
			runCount++;
			let func = null;
			item = -1;
			if (i === 2) {
				if (!config.canTask) {

				} else { i++ }
			}
			if (i === 3) {
				taskStatus = { 'item': 0, 'name': '', 'canReward': false };
			}
			if (i === 4) {
				DataPostBodyList[i] = task;
				if (config.hasTileMatch && !taskStatus.canReward || config.hasTask
					|| config.canTask && !config.hasTileMatch
				) { i++; }
				//if (taskStatus.item > 2 && !taskStatus.canReward) { i = taskStatus.item; }
			}
			if (i === 7) {
				DataPostBodyList[i].map = config.map;
				DataPostBodyList[i].requestID = config.shopeeInfo.token.SPC_U + '_' + getToken();
				DataPostBodyList[i].levelMode = config.levelMode;
			}
			if (i === 9) {
				await delay(5.0);
				DataPostBodyList[i].token = config.token;
				DataPostBodyList[i].requestID = config.shopeeInfo.token.SPC_U + '_' + getToken();
				DataPostBodyList[i].info.targetTiles = config.ga1;
				DataPostBodyList[i].info.clearTiles = config.ga1;
				DataPostBodyList[i].info.moveTiles = config.ga1;
				DataPostBodyList[i].info.tilesType = config.ga2;
			}
			if (i === 10) {
				await delay(10.0);
				DataPostBodyList[i].token = config.token;
				DataPostBodyList[i].requestID = config.shopeeInfo.token.SPC_U + '_' + getToken();
				DataPostBodyList[i].info.targetTiles = config.gb1;
				DataPostBodyList[i].info.clearTiles = config.gb1;
				DataPostBodyList[i].info.moveTiles = config.gb1;
				DataPostBodyList[i].info.tilesType = config.gb2;
			}


			let dc = GetDataConfig(i, null, null, null, null, func);
			// console.log(`\nüåê ${dc.method} URL : ${dc.url}\n`);
			if (flag && dc.method === 'GET') {
				await dataGet(dc).then(data => dc.func(data, dc)).then(r => { flag = r });
			} else if (flag && dc.method === 'POST') {
				await dataPost(dc, item).then(data => dc.func(data, dc)).then(r => { flag = r });
			}
			//if (i >= 10) break;
			// 2 È†òÂÆåÊ∞¥Âæå Âèä  i=? Áé©ÈÅéÂæå ÈúÄ Ë¶ÅÈáçÊñ∞Âèñ‰ªªÂãô
			if (!flag && i === 2) { flag = true; }
			if (flag && (i === 4)) { i = 1; config.canTask = false; }
			if (!flag && i == 3 && config.hasTask) { flag = true; }
			if (runCount >= forMaxCount) { break; }
			if (runCount > 15) { console.log(`!! Need Debug !! ‚òÖ‚òÖ‚òÖ Ëø¥Âúà ${runCount}/${forMaxCount} ‚òÖ‚òÖ‚òÖ`) };
		}
		console.log('');
		let msg = '‚úÖ ËôïÁêÜÂ∑≤ÂÆåÊàê';
		// console.log(msg);
		if (!needLastNotify) { showNotification = needLastNotify; }
		loonNotify(msg);
	} catch (error) {
		handleError(error);
	}
	$done({});
})();

